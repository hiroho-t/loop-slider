<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ループスライダー</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        background: white;
        border-radius: 20px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        overflow: hidden;
      }

      .header {
        background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        color: white;
        padding: 30px;
        text-align: center;
      }

      .header h1 {
        font-size: 2.5rem;
        margin-bottom: 10px;
        font-weight: 700;
      }

      .header p {
        font-size: 1.1rem;
        opacity: 0.9;
      }

      .controls {
        padding: 30px;
        background: #f8f9fa;
        border-bottom: 1px solid #e9ecef;
      }

      .upload-area {
        border: 3px dashed #4facfe;
        border-radius: 15px;
        padding: 40px;
        text-align: center;
        background: white;
        margin-bottom: 30px;
        transition: all 0.3s ease;
        cursor: pointer;
      }

      .upload-area:hover {
        border-color: #00f2fe;
        background: #f0f9ff;
      }

      .upload-area.dragover {
        border-color: #00f2fe;
        background: #e0f2fe;
        transform: scale(1.02);
      }

      .upload-icon {
        font-size: 3rem;
        color: #4facfe;
        margin-bottom: 15px;
      }

      .upload-text {
        font-size: 1.2rem;
        color: #666;
        margin-bottom: 10px;
      }

      .upload-subtext {
        color: #999;
        font-size: 0.9rem;
      }

      #fileInput {
        display: none;
      }

      .settings {
        display: grid;
        grid-template-columns: 1fr;
        gap: 30px;
        margin-top: 20px;
      }

      .setting-group {
        background: white;
        padding: 25px;
        border-radius: 15px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        max-width: 400px;
        margin: 0 auto;
      }

      .setting-label {
        font-weight: 600;
        color: #333;
        margin-bottom: 15px;
        font-size: 1.1rem;
      }

      .slider-container {
        position: relative;
      }

      .slider {
        width: 100%;
        height: 8px;
        border-radius: 4px;
        background: #e9ecef;
        outline: none;
        -webkit-appearance: none;
        margin-bottom: 10px;
      }

      .slider::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 24px;
        height: 24px;
        border-radius: 50%;
        background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        cursor: pointer;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
      }

      .slider::-moz-range-thumb {
        width: 24px;
        height: 24px;
        border-radius: 50%;
        background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        cursor: pointer;
        border: none;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
      }

      .slider-value {
        text-align: center;
        font-weight: 600;
        color: #4facfe;
        font-size: 1.1rem;
      }

      .carousel-container {
        padding: 50px 30px;
        background: #f8f9fa;
      }

      .embed-section {
        padding: 30px;
        background: #f8f9fa;
        border-top: 1px solid #e9ecef;
      }

      .embed-container {
        background: white;
        border-radius: 15px;
        padding: 25px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
      }

      .embed-title {
        font-weight: 600;
        color: #333;
        margin-bottom: 15px;
        font-size: 1.1rem;
      }

      .embed-code {
        background: #f8f9fa;
        border: 1px solid #e9ecef;
        border-radius: 8px;
        padding: 15px;
        font-family: "Courier New", monospace;
        font-size: 0.9rem;
        color: #666;
        white-space: pre-wrap;
        word-break: break-all;
        max-height: 200px;
        overflow-y: auto;
        margin-bottom: 15px;
      }

      .copy-btn {
        background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s ease;
      }

      .copy-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(79, 172, 254, 0.4);
      }

      .copy-btn.copied {
        background: #28a745;
      }

      .carousel-wrapper {
        background: white;
        border-radius: 15px;
        overflow: hidden;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        height: 300px;
        position: relative;
        display: flex;
        align-items: center;
        padding: 40px 0;
      }

      .carousel-track {
        display: flex;
        height: 220px;
        align-items: center;
        transition: none;
      }

      .carousel-item {
        flex-shrink: 0;
        height: 100%;
        margin-right: 20px;
      }

      .carousel-item:last-child {
        margin-right: 20px;
      }

      .carousel-item img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        border-radius: 10px;
      }

      .no-images {
        display: flex;
        align-items: center;
        justify-content: center;
        height: 100%;
        color: #999;
        font-size: 1.2rem;
      }

      @media (max-width: 768px) {
        .settings {
          grid-template-columns: 1fr;
        }

        .header h1 {
          font-size: 2rem;
        }

        .controls {
          padding: 20px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>🎠 ループスライダー</h1>
        <p>画像をアップロードして、ループアニメーションを作成</p>
      </div>

      <div class="controls">
        <div
          class="upload-area"
          onclick="document.getElementById('fileInput').click()"
        >
          <div class="upload-icon">📸</div>
          <div class="upload-text">
            画像をアップロードまたはドラッグ&ドロップ
          </div>
        </div>
        <input type="file" id="fileInput" accept="image/*" />

        <div class="settings">
          <div class="setting-group">
            <div class="setting-label">ループ速度</div>
            <div class="slider-container">
              <input
                type="range"
                class="slider"
                id="speedSlider"
                min="1"
                max="50"
                value="25"
              />
              <div class="slider-value" id="speedValue">普通</div>
            </div>
          </div>
        </div>
      </div>

      <div class="carousel-container">
        <div class="carousel-wrapper">
          <div class="carousel-track" id="carouselTrack">
            <div class="no-images">画像をアップロードしてカルーセルを開始</div>
          </div>
        </div>
      </div>

      <div class="embed-section" id="embedSection" style="display: none">
        <div class="embed-container">
          <div class="embed-title">📋 iframe埋め込みコード</div>
          <div class="embed-code" id="embedCode"></div>
          <button class="copy-btn" id="copyBtn" onclick="copyEmbedCode()">
            コードをコピー
          </button>
        </div>
      </div>
    </div>

    <script>
      let uploadedImages = [];
      let animationSpeed = 25;

      const fileInput = document.getElementById("fileInput");
      const uploadArea = document.querySelector(".upload-area");
      const carouselTrack = document.getElementById("carouselTrack");
      const speedSlider = document.getElementById("speedSlider");
      const speedValue = document.getElementById("speedValue");

      // ドラッグ&ドロップ機能
      uploadArea.addEventListener("dragover", (e) => {
        e.preventDefault();
        uploadArea.classList.add("dragover");
      });

      uploadArea.addEventListener("dragleave", () => {
        uploadArea.classList.remove("dragover");
      });

      uploadArea.addEventListener("drop", (e) => {
        e.preventDefault();
        uploadArea.classList.remove("dragover");
        const files = Array.from(e.dataTransfer.files).filter((file) =>
          file.type.startsWith("image/")
        );
        if (files.length > 0) {
          handleFiles([files[0]]); // 最初の1枚のみ処理
        }
      });

      // ファイル選択
      fileInput.addEventListener("change", (e) => {
        const files = Array.from(e.target.files);
        if (files.length > 0) {
          handleFiles([files[0]]); // 最初の1枚のみ処理
        }
      });

      // ファイル処理
      function handleFiles(files) {
        // 既存の画像をクリア
        uploadedImages = [];

        const file = files[0];
        const reader = new FileReader();
        reader.onload = (e) => {
          const imageData = {
            id: Date.now() + Math.random(),
            src: e.target.result,
            name: file.name,
          };
          uploadedImages.push(imageData);
          updateCarousel();
        };
        reader.readAsDataURL(file);
      }

      // カルーセル更新
      function updateCarousel() {
        if (uploadedImages.length === 0) {
          carouselTrack.innerHTML =
            '<div class="no-images">画像をアップロードしてカルーセルを開始</div>';
          stopAnimation();
          document.getElementById("embedSection").style.display = "none";
          return;
        }

        // 画像を十分な数だけ繰り返し配置（スムーズなループのため）
        let carouselHTML = "";
        const repeatCount = 20; // 十分な数を繰り返し

        for (let i = 0; i < repeatCount; i++) {
          uploadedImages.forEach((image) => {
            carouselHTML += `
                        <div class="carousel-item">
                            <img src="${image.src}" alt="${image.name}">
                        </div>
                    `;
          });
        }

        carouselTrack.innerHTML = carouselHTML;
        startAnimation();
        generateEmbedCode();
      }

      // 埋め込みコード生成
      function generateEmbedCode() {
        if (uploadedImages.length === 0) return;

        const image = uploadedImages[0];
        const duration = (51 - animationSpeed) * 2000;

        const embedHTML = `<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loop Slider</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            background: #f8f9fa; 
            height: 100vh; 
            display: flex; 
            align-items: center; 
            justify-content: center;
            overflow: hidden;
        }
        .carousel-wrapper {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            height: 300px;
            width: 100%;
            max-width: 800px;
            position: relative;
            display: flex;
            align-items: center;
            padding: 40px 0;
        }
        .carousel-track {
            display: flex;
            height: 220px;
            align-items: center;
            animation: slide ${duration}ms linear infinite;
        }
        .carousel-item {
            flex-shrink: 0;
            height: 100%;
            margin-right: 20px;
        }
        .carousel-item img {
            width: auto;
            height: 100%;
            object-fit: cover;
            border-radius: 10px;
        }
        @keyframes slide {
            0% { transform: translateX(0); }
            100% { transform: translateX(-320px); }
        }
    </style>
</head>
<body>
    <div class="carousel-wrapper">
        <div class="carousel-track">
            ${Array(20)
              .fill()
              .map(
                () => `
            <div class="carousel-item">
                <img src="${image.src}" alt="Loop Image">
            </div>`
              )
              .join("")}
        </div>
    </div>
</body>
</html>`;

        document.getElementById("embedCode").textContent = embedHTML;
        document.getElementById("embedSection").style.display = "block";
      }

      // コピー機能
      function copyEmbedCode() {
        const embedCode = document.getElementById("embedCode").textContent;
        navigator.clipboard.writeText(embedCode).then(() => {
          const copyBtn = document.getElementById("copyBtn");
          copyBtn.textContent = "コピー完了！";
          copyBtn.classList.add("copied");
          setTimeout(() => {
            copyBtn.textContent = "コードをコピー";
            copyBtn.classList.remove("copied");
          }, 2000);
        });
      }

      let animationId;
      let startTime;
      let currentPosition = 0;

      // アニメーション開始
      function startAnimation() {
        stopAnimation();

        const items = carouselTrack.children;
        if (items.length === 0) return;

        // 1つの画像の幅を計算（余白込み）
        const singleItemWidth = items[0].offsetWidth + 20; // margin-right分も含める

        startTime = performance.now();

        function animate(currentTime) {
          if (!startTime) startTime = currentTime;

          const duration = (51 - animationSpeed) * 2000; // 大幅に遅く調整
          const elapsed = currentTime - startTime;
          const progress = (elapsed % duration) / duration;

          currentPosition = -progress * singleItemWidth;
          carouselTrack.style.transform = `translateX(${currentPosition}px)`;

          animationId = requestAnimationFrame(animate);
        }

        animationId = requestAnimationFrame(animate);
      }

      // アニメーション停止
      function stopAnimation() {
        if (animationId) {
          cancelAnimationFrame(animationId);
          animationId = null;
        }
      }

      // スライダーイベント
      speedSlider.addEventListener("input", (e) => {
        animationSpeed = parseInt(e.target.value);
        let speedLabel;
        if (animationSpeed <= 5) speedLabel = "極めて遅い";
        else if (animationSpeed <= 10) speedLabel = "非常に遅い";
        else if (animationSpeed <= 15) speedLabel = "とても遅い";
        else if (animationSpeed <= 20) speedLabel = "遅い";
        else if (animationSpeed <= 25) speedLabel = "やや遅い";
        else if (animationSpeed <= 30) speedLabel = "普通";
        else if (animationSpeed <= 35) speedLabel = "やや速い";
        else if (animationSpeed <= 40) speedLabel = "速い";
        else if (animationSpeed <= 45) speedLabel = "非常に速い";
        else speedLabel = "極めて速い";

        speedValue.textContent = speedLabel;
        if (uploadedImages.length > 0) {
          startAnimation();
          generateEmbedCode();
        }
      });

      // 初期化
      updateCarousel();
    </script>
    <script>
      (function () {
        function c() {
          var b = a.contentDocument || a.contentWindow.document;
          if (b) {
            var d = b.createElement("script");
            d.innerHTML =
              "window.__CF$cv$params={r:'97398785a26ae383',t:'MTc1NTk0MDc3OC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";
            b.getElementsByTagName("head")[0].appendChild(d);
          }
        }
        if (document.body) {
          var a = document.createElement("iframe");
          a.height = 1;
          a.width = 1;
          a.style.position = "absolute";
          a.style.top = 0;
          a.style.left = 0;
          a.style.border = "none";
          a.style.visibility = "hidden";
          document.body.appendChild(a);
          if ("loading" !== document.readyState) c();
          else if (window.addEventListener)
            document.addEventListener("DOMContentLoaded", c);
          else {
            var e = document.onreadystatechange || function () {};
            document.onreadystatechange = function (b) {
              e(b);
              "loading" !== document.readyState &&
                ((document.onreadystatechange = e), c());
            };
          }
        }
      })();
    </script>
  </body>
</html>
